
{% extends "base.html.jinja" %}

{% block title %}Edit - {{ page.title }}{% endblock %}

{% block header %}
Edit - {{ page.title }}
{% endblock %}


{% block content %}
<form method="POST">
    <div class="form-group">
        <label for="title" aria-describedby="TitleHelpInline">Title</label>
        <span id="TitleHelpInline" class="form-text">
        | Please give your page a title.
        </span>
        <input type="text" id="title" name="title" class="form-control" style="background-color: rgba(0, 0, 0, 0.25) ; color: #fff;"  required value="{{ page.title }}">
    </div>
    <div class="form-group mt-2">
        <label for="content" aria-describedby="ContentHelpInline">Content</label>
        <span id="ContentHelpInline" class="form-text">
        | Please add some MarkDown content.
        </span>
        <textarea id="content" name="content" class="form-control" rows="10" style="background-color: rgba(0, 0, 0, 0.25) ; color: #fff;" required>{{ page.content }}</textarea>
    </div>
    <div class="form-group mt-2">
        <button type="submit" class="btn btn-light">Save</button>
    </div>
</form>

<div class="card mt-4">
    <div class="card-header">
        Preview
    </div>
    <div class="card-body" id="preview">
        <!-- Live preview will be rendered here -->
    </div>
</div>
<a href="{{ url_for('home') }}" class="btn btn-secondary mt-3">Back to home</a>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener("DOMContentLoaded", function() {
    // Extract the content element
    const contentElement = document.getElementById('content');

    // Define a function to fetch and render markdown content
    function fetchAndRender(content) {
        fetch('/render_md', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({content: content}),
        })
        .then(response => response.json())
        .then(data => {
            document.getElementById('preview').innerHTML = data.content;
        });
    }

    // Fetch and render content on page load
    fetchAndRender(contentElement.value);

    // Also fetch and render content whenever it changes
    contentElement.addEventListener('input', function() {
        fetchAndRender(this.value);
    });
});
</script>
{% endblock %}